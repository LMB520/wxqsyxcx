一、项目概述

本项目旨在开发一款去水印小程序，支持用户提交短视频、图片或实况图链接，通过后端调用第三方API解析并返回去水印后的直链。小程序前端包含三个主要页面：首页、积分页和我的页面，同时配备后台管理端，用于管理用户、解析记录、广告及积分规则等。

---

二、技术栈

· 前端：微信小程序（符合微信小程序开发规范）
· 后端：PHP ≥ 8.0 + MySQL ≥ 5.7
· 第三方API：去水印解析接口（示例：`https://api.czmao.cn/home/api?uid=xxx&key=xxx&url=`）

---

三、小程序端功能模块

1. 首页

· 链接提交：
  · 用户输入短视频、图片或实况图链接（支持多平台）。
  · 提交时自动过滤无关文本，仅保留纯净链接。
  · 提交后扣除用户积分（积分数量后台可配置）。
  · 安全性：对用户提交的链接进行合法性校验，包括格式验证和内容安全过滤，防范恶意请求。
· 内容展示：
  · 顶部轮播图，后台可配置图片/跳转链接。
  · Banner广告或视频广告位，支持微信流量主（广告ID后台可配置）。
  · 公告栏，后台可编辑发布。
· 解析结果：
  · 调用后端API解析链接，返回标题、封面、类型及直链（视频、图片或实况图）。
  · 直链通过服务器中转后返回前端，确保可访问性。
  · 用户体验：解析过程提供明显的加载状态，失败时给出明确提示（如网络错误、链接无效等）。
· 广告位：
  · Banner广告或视频广告位，支持微信流量主（广告ID后台可配置）。

2. 积分页

· 积分获取方式：
  · 签到：每日签到获取积分（数量后台可配置）。
  · 邀请好友：成功邀请好友后获得积分（规则后台可配置）。
  · 激励式广告：观看激励视频广告获得积分（广告ID后台可配置，可开关）。
  · 限制用户每日通过观看广告获取积分的次数（后台可配置）。
· 广告位：
  · Banner广告或视频广告位，支持微信流量主（广告ID后台可配置）。

3. 我的页面

· 用户登录：
  · 微信一键登录，自动获取微信头像与昵称，保存至后端数据库。
· 个人数据：
  · 当前积分余额及明细。
  · 成功邀请好友数量。
  · 历史解析记录列表（链接、解析结果、时间）。
  · 激励广告观看次数统计及通过广告获取的积分总额。
· 广告位：
  · Banner广告或视频广告位，支持微信流量主（广告ID后台可配置）。

---

四、后端API功能

1. 用户登录：通过微信 code 获取 openid，注册/登录用户。
2. 链接解析：
   · 接收小程序提交的链接，调用第三方API解析。
   · 中转直链，返回标题、封面、类型及资源直链。
   · 注意：由于解析返回的链接具有时效性，因此不设置缓存。
3. 积分扣减与记录：
   · 提交链接时扣除积分，记录明细。
   · 支持签到、邀请、观看广告等积分变更记录。
4. 数据管理：
   · 用户信息、解析历史、积分明细等数据的存储与查询。
5. 广告与配置：
   · 返回轮播图、公告、广告ID等配置信息。

---

五、后台管理端

1. 用户管理：查看用户列表、禁用/启用账户、重置密码等。
2. 解析历史管理：查询用户解析记录，支持按时间、用户筛选。
3. 小程序信息管理：配置 appid、appsecret 等微信相关参数。
4. 广告管理：
   · 配置各页面广告类型（Banner/视频/关闭）。
   · 配置激励广告开关及每次观看获取的积分数。
   · 限制用户每日通过观看广告获取积分的次数。
5. 积分规则管理：
   · 设置链接解析扣除积分数。
   · 设置签到、邀请奖励积分数。
6. 内容管理：
   · 轮播图上传与配置。
   · 公告发布与编辑。
7. 后台体验：管理端采用响应式布局，支持PC端和移动端操作，提升管理员操作体验。

---

六、安全性、用户体验与后台体验的特别说明

1. 安全性：
   · 对用户提交的链接进行严格的合法性校验，包括格式验证（如URL格式）和内容安全过滤（如防止XSS攻击）。
   · 后端API接口进行鉴权，防止未授权访问。
   · 数据库操作使用预处理语句，防止SQL注入。
2. 用户体验：
   · 解析过程提供明显的加载状态（如loading动画）。
   · 操作失败时给出明确的错误提示，如“链接无效，请检查后重试”、“积分不足，请获取积分后再试”等。
   · 界面设计简洁明了，操作流程顺畅。
3. 后台体验：
   · 后台管理界面采用响应式设计，适配不同屏幕尺寸。
   · 操作流程简化，常用功能（如用户管理、广告配置）放在显眼位置。
   · 提供数据统计图表，方便管理员了解系统运行状况。

---

七、第三方API响应格式示例

解析成功返回以下三种格式之一：

```json
{
  "code": "0001",
  "msg": "解析成功",
  "data": {
    "desc": "标题",
    "cover": "封面",
    "type": 2,
    "pics": ["图片直链接1", "图片直链接2"]
  },
  "source": "api.czmao.cn"
}
```

```json
{
  "code": "0001",
  "msg": "解析成功",
  "data": {
    "desc": "标题",
    "cover": "封面",
    "type": 1,
    "playAddr": "视频直链接"
  },
  "source": "api.czmao.cn"
}
```

```json
{
  "code": "0001",
  "msg": "解析成功",
  "data": {
    "desc": "标题",
    "cover": "封面",
    "type": 2,
    "live": ["实况图链接1"]
  },
  "source": "api.czmao.cn"
}
```

---

八、小程序开发规范注意事项

1. 目录结构：严格按照微信小程序规范，页面文件放在 pages 目录下，每个页面由四个文件组成（js、json、wxml、wxss）。
2. 代码规范：
   · 使用 ES6+ 语法，但注意微信小程序环境的兼容性。
   · 样式使用 rpx 单位，确保不同屏幕尺寸的适配。
   · 网络请求使用 wx.request，并封装成 Promise 风格。
3. 性能优化：
   · 避免在页面 onLoad 时执行过多同步操作。
4. 安全规范：
   · 所有网络请求使用 HTTPS。
   · 用户敏感信息（如 openid）不存储在前端。
   · 不在前端进行敏感逻辑判断（如积分扣除）。
   
九、项目目录结构
watermark-remover-miniprogram/
│
├── mini-program/                    # 微信小程序前端
│   ├── pages/                       # 页面目录
│   │   ├── index/                   # 首页
│   │   │   ├── index.js
│   │   │   ├── index.json
│   │   │   ├── index.wxml
│   │   │   └── index.wxss
│   │   ├── points/                  # 积分页
│   │   │   ├── points.js
│   │   │   ├── points.json
│   │   │   ├── points.wxml
│   │   │   └── points.wxss
│   │   └── mine/                    # 我的页面
│   │       ├── mine.js
│   │       ├── mine.json
│   │       ├── mine.wxml
│   │       └── mine.wxss
│   ├── components/                  # 自定义组件目录
│   ├── utils/                       # 工具类目录
│   │   ├── request.js               # 网络请求封装
│   │   ├── validate.js              # 链接校验工具
│   │   └── utils.js                 # 通用工具函数
│   ├── app.js                       # 小程序入口文件
│   ├── app.json                     # 全局配置
│   ├── app.wxss                     # 全局样式
│   └── project.config.json          # 项目配置文件
│
├── server/                          # 后端PHP项目
│   ├── api/                         # 接口目录
│   │   ├── user.php                 # 用户相关接口
│   │   ├── parse.php                # 解析接口
│   │   ├── points.php               # 积分接口
│   │   ├── ad.php                   # 广告配置接口
│   │   ├── banner.php               # 轮播图接口
│   │   └── notice.php               # 公告接口
│   ├── lib/                         # 库文件目录
│   │   ├── db.php                   # 数据库操作类
│   │   ├── wechat.php               # 微信登录类
│   │   ├── security.php             # 安全过滤类
│   │   └── common.php               # 通用函数
│   ├── config/                      # 配置文件目录
│   │   ├── database.php             # 数据库配置
│   │   └── wechat.php               # 微信配置
│   ├── admin/                       # 后台管理端（PHP）
│   │   ├── index.php                # 后台首页
│   │   ├── login.php                # 登录页
│   │   ├── modules/                 # 功能模块目录
│   │   │   ├── user.php             # 用户管理
│   │   │   ├── parse_log.php        # 解析记录管理
│   │   │   ├── ad_config.php        # 广告配置
│   │   │   ├── points_rule.php      # 积分规则管理
│   │   │   ├── banner.php           # 轮播图管理
│   │   │   └── notice.php           # 公告管理
│   │   ├── static/                  # 静态资源
│   │   │   ├── css/
│   │   │   ├── js/
│   │   │   └── images/
│   │   └── include/                 # 公共包含文件
│   │       ├── header.php
│   │       ├── footer.php
│   │       └── sidebar.php
│   ├── database/                    # 数据库相关
│   │   ├── sql/                     # SQL文件目录
│   │   │   └── install.sql          # 初始化数据库SQL
│   │   └── migrations/              # 数据库迁移文件（可选）
│   └── logs/                        # 日志目录
│
├── third-party-api/                 # 第三方API调用封装目录
│   └── watermark_api.php            # 去水印API调用类
│
└── README.md                        # 项目说明文档